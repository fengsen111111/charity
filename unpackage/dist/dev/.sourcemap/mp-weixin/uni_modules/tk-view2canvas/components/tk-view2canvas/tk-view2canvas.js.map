{"version":3,"sources":["webpack:///D:/Users/Desktop/送酒/charity/uni_modules/tk-view2canvas/components/tk-view2canvas/tk-view2canvas.vue?0fc9","webpack:///D:/Users/Desktop/送酒/charity/uni_modules/tk-view2canvas/components/tk-view2canvas/tk-view2canvas.vue?6085","webpack:///D:/Users/Desktop/送酒/charity/uni_modules/tk-view2canvas/components/tk-view2canvas/tk-view2canvas.vue?61f4","webpack:///D:/Users/Desktop/送酒/charity/uni_modules/tk-view2canvas/components/tk-view2canvas/tk-view2canvas.vue?a690","uni-app:///uni_modules/tk-view2canvas/components/tk-view2canvas/tk-view2canvas.vue"],"names":["name","data","props","canvasWidth","type","default","canvasHeight","methods","rpxtopx","drawCanvas","promiseIndex","promiseArray","imageArray","imageIndex","uni","title","width","height","i","resolve","img","p","ctx","dpr","arrayInfo","fs","filePath","encoding","success","path","console","fail","complete"],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAA2H;AAC3H;AACkE;AACL;;;AAG7D;AACyK;AACzK,gBAAgB,6KAAU;AAC1B,EAAE,oFAAM;AACR,EAAE,yFAAM;AACR,EAAE,kGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,6FAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACtBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAyoB,CAAgB,wnBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;ACM7pB;AACA;AACA;AACA;AAAA,eACA;EACAA;EACAC;IACA,QAEA;EACA;EACAC;IACAC;MACAC;MACAC;IACA;IACAC;MACAF;MACAC;IACA;EACA;EACAE;IAEA;IACAC;MACA;MACA;MACA;IACA;IAEAC;MACAC;MACAC;MACAC;MACAC;MACAC;QACAC;MACA;MACA;MACA;QACAX;QACAY;QACAC;MACA;MACA;MAEA;;MAEA;MACA;QACAN;QACAD;MACA;;MAEA;MACA;MAAA,2BACAQ;QACAP;UACA;YACAQ;UACA;YACAA;UACA;YACA;YACAC;YACAA;cACAR;cACAO;YACA;YACAC;UACA;QACA;MAAA;MAfA;QAAA;MAgBA;;MAEA;MACA;MACAC;QACA;QACA;UACA;YACAC;YACAA;YACAA;YACAA,yFACAd;UACA;YACAc;YACAA,0FACAC;UACA;YACAD,4FACAE;YACAX;UACA;QACA;QACA;QACA;QACA;QACA;QACAH;QACAC;QACAC;QACAC;QACAY;UACAC;UACAzB;UACA0B;UACAC;YACAd;cACAe;cACAD;gBACAE;cACA;YACA;UACA;UACAC;YACAD;UACA;UACAE;YACAlB;UACA;QACA;MACA;IACA;EACA;AACA;AAAA,2B","file":"uni_modules/tk-view2canvas/components/tk-view2canvas/tk-view2canvas.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./tk-view2canvas.vue?vue&type=template&id=04908001&\"\nvar renderjs\nimport script from \"./tk-view2canvas.vue?vue&type=script&lang=js&\"\nexport * from \"./tk-view2canvas.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"uni_modules/tk-view2canvas/components/tk-view2canvas/tk-view2canvas.vue\"\nexport default component.exports","export * from \"-!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./tk-view2canvas.vue?vue&type=template&id=04908001&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./tk-view2canvas.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./tk-view2canvas.vue?vue&type=script&lang=js&\"","<template>\n\t<view>\n\t</view>\n</template>\n \n<script>\n\tlet promiseIndex = 0\n\tlet promiseArray = []\n\tlet imageArray = []\n\tlet imageIndex = 0\n\texport default {\n\t\tname: \"kt-view2canvas\",\n\t\tdata() {\n\t\t\treturn {\n \n\t\t\t};\n\t\t},\n\t\tprops: {\n\t\t\tcanvasWidth: {\n\t\t\t\ttype: Number,\n\t\t\t\tdefault: 1080\n\t\t\t},\n\t\t\tcanvasHeight: {\n\t\t\t\ttype: Number,\n\t\t\t\tdefault: 2500\n\t\t\t}\n\t\t},\n\t\tmethods: {\n \n\t\t\t//rpx转换为px的工具函数\n\t\t\trpxtopx(rpx) {\n\t\t\t\tlet deviceWidth = wx.getSystemInfoSync().windowWidth; //获取设备屏幕宽度\n\t\t\t\tlet px = (deviceWidth / 750) * Number(rpx)\n\t\t\t\treturn Math.floor(px);\n\t\t\t},\n \n\t\t\tdrawCanvas(arrayInfo) {\n\t\t\t\tpromiseIndex = 0\n\t\t\t\tpromiseArray = []\n\t\t\t\timageArray = []\n\t\t\t\timageIndex = 0\n\t\t\t\tuni.showLoading({\n\t\t\t\t\ttitle: '保存中...'\n\t\t\t\t})\n\t\t\t\t// 0.创建canvas及ctx,并获取屏幕的dpr\n\t\t\t\tconst canvas = wx.createOffscreenCanvas({\n\t\t\t\t\ttype: '2d',\n\t\t\t\t\twidth: this.canvasWidth,\n\t\t\t\t\theight: this.canvasHeight\n\t\t\t\t})\n\t\t\t\tconst ctx = canvas.getContext('2d')\n \n\t\t\t\tconst dpr = uni.getWindowInfo().pixelRatio\n \n\t\t\t\t// 1.根据数组数量创建promise数组\n\t\t\t\tfor (let i = 0; i < arrayInfo.length; i++) {\n\t\t\t\t\tpromiseArray.push(promiseIndex)\n\t\t\t\t\tpromiseIndex++\n\t\t\t\t}\n \n\t\t\t\t// 2.根据数组给promise数组赋值\n\t\t\t\tlet that = this\n\t\t\t\tfor (let i = 0; i < arrayInfo.length; i++) {\n\t\t\t\t\tpromiseArray[i] = new Promise(function(resolve, reject) {\n\t\t\t\t\t\tif (arrayInfo[i].type == 'text') {\n\t\t\t\t\t\t\tresolve()\n\t\t\t\t\t\t} else if (arrayInfo[i].type == 'view') {\n\t\t\t\t\t\t\tresolve()\n\t\t\t\t\t\t} else if (arrayInfo[i].type == 'image') {\n\t\t\t\t\t\t\tlet img = canvas.createImage()\n\t\t\t\t\t\t\timg.src = arrayInfo[i].src\n\t\t\t\t\t\t\timg.onload = function() {\n\t\t\t\t\t\t\t\timageArray.push(img)\n\t\t\t\t\t\t\t\tresolve()\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\timg.src = arrayInfo[i].src + `?${new Date().getTime()}`\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n \n\t\t\t\t// 3.异步全部加载完成后，绘制图片\n\t\t\t\tlet p = Promise.all(promiseArray)\n\t\t\t\tp.then(function() {\n\t\t\t\t\t//根据数组顺序绘制图片\n\t\t\t\t\tfor (let i = 0; i < arrayInfo.length; i++) {\n\t\t\t\t\t\tif (arrayInfo[i].type == 'text') {\n\t\t\t\t\t\t\tctx.fillStyle = arrayInfo[i].color\n\t\t\t\t\t\t\tctx.font = that.rpxtopx(arrayInfo[i].size) * dpr + 'px sans-serif'\n\t\t\t\t\t\t\tctx.textBaseline = 'top'\n\t\t\t\t\t\t\tctx.fillText(arrayInfo[i].word, arrayInfo[i].posX * dpr, (arrayInfo[i].posY + that\n\t\t\t\t\t\t\t\t.rpxtopx(20)) * dpr)\n\t\t\t\t\t\t} else if (arrayInfo[i].type == 'view') {\n\t\t\t\t\t\t\tctx.fillStyle = arrayInfo[i].bgColor\n\t\t\t\t\t\t\tctx.fillRect(arrayInfo[i].posX * dpr, arrayInfo[i].posY * dpr, arrayInfo[i].width *\n\t\t\t\t\t\t\t\tdpr, arrayInfo[i].height * dpr)\n\t\t\t\t\t\t} else if (arrayInfo[i].type == 'image') {\n\t\t\t\t\t\t\tctx.drawImage(imageArray[imageIndex], arrayInfo[i].posX * dpr, arrayInfo[i].posY * dpr,\n\t\t\t\t\t\t\t\tarrayInfo[i].width * dpr, arrayInfo[i].height * dpr)\n\t\t\t\t\t\t\timageIndex++\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tconst fileData = canvas.toDataURL()\n\t\t\t\t\tconst fs = uni.getFileSystemManager()\n\t\t\t\t\tconst path = `${wx.env.USER_DATA_PATH}/` + new Date().getTime() + `hello.png`\n\t\t\t\t\t//数据归零\n\t\t\t\t\tpromiseIndex = 0\n\t\t\t\t\tpromiseArray = []\n\t\t\t\t\timageArray = []\n\t\t\t\t\timageIndex = 0\n\t\t\t\t\tfs.writeFile({\n\t\t\t\t\t\tfilePath: path,\n\t\t\t\t\t\tdata: fileData.replace(/^data:image\\/\\w+;base64,/, \"\"),\n\t\t\t\t\t\tencoding: 'base64',\n\t\t\t\t\t\tsuccess(res) {\n\t\t\t\t\t\t\tuni.showShareImageMenu({\n\t\t\t\t\t\t\t\tpath: path,\n\t\t\t\t\t\t\t\tsuccess: res => {\n\t\t\t\t\t\t\t\t\tconsole.log(res);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfail(res) {\n\t\t\t\t\t\t\tconsole.error(res)\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcomplete() {\n\t\t\t\t\t\t\tuni.hideLoading()\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t}\n</script>\n \n<style>\n \n</style>"],"sourceRoot":""}